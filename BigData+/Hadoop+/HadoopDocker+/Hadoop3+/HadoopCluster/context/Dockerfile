ARG HADOOP_VERSION
ARG SPARK_VERSION
ARG SPARK_BASE_IMAGE_TAG
FROM spark-base-image-${SPARK_VERSION}-hadoop-${HADOOP_VERSION}:${SPARK_BASE_IMAGE_TAG}

ARG HADOOP_VERSION

ENV HADOOP_HOME=/opt/hadoop
ENV SPARK_HOME=/opt/spark
ENV SPARK_CONF_DIR=${SPARK_HOME}/conf
ENV HADOOP_CONF_DIR=${HADOOP_HOME}/etc/hadoop
ENV HADOOP_LOG_DIR=/tmp/logs
ENV HADOOP_VERSION=${HADOOP_VERSION}
ENV PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$SPARK_HOME/bin::$SPARK_HOME/sbin
ENV HADOOP_ENV_SH=${HADOOP_CONF_DIR}/hadoop-env.sh

ADD *.xml ${HADOOP_CONF_DIR}/
ADD spark-defaults.conf ${SPARK_CONF_DIR}/
ADD *.sh ${HADOOP_HOME}/
ADD java-opts ${HADOOP_CONF_DIR}/

RUN mkdir -p ${HADOOP_LOG_DIR} \
  && sed -i "s@\${JAVA_HOME}@${JAVA_HOME}@g" ${HADOOP_ENV_SH} \
  && cat ${HADOOP_HOME}/hadoop-env-append.sh >> ${HADOOP_ENV_SH}

WORKDIR ${HADOOP_HOME}
