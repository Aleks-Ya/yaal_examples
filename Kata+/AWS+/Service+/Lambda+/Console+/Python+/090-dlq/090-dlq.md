# 090-dlq

## Task
Use Dead Letter Queue to capture failures of a Lambda Function.

## Steps
1. Create a Queue
	1. Type: `Standard`
	2. Name: `kata-q-dlq`
2. Create an Execution Role
	1. Create an IAM Role
		1. Trusted entity type: `AWS service`
		2. Service or use case: `Lambda`
		3. Permissions policies:
			1. `AWSLambdaBasicExecutionRole`
		4. Role name: `kata-role-dlq`
	2. Assign permissions
		1. Create inline policy
			1. Service: `SQS`
			2. Actions allowed: `SendMessage`
			3. Resources: `arn:aws:sqs:us-east-1:523633434047:kata-q-dlq`
			4. Policy name: `kata-policy-dlq`
3. Create a Function
	1. Create a function:
		1. Template: `Author from scratch`
		2. Function name: `kata-f-dlq`
		2. Runtime: `Python`
		3. Architecture: `x86_64`
		4. Permissions:
			1. Execution role:
				1. Use an existing role: `kata-role-dlq`
	2. Define handler:
		```python
		def lambda_handler(event, context):
			dividend: int = event.get('dividend')
			divisor: int = event.get('divisor')
			quotient: float = dividend / divisor
			return f"Result: {quotient}"
		```
	3. Deploy the function
	4. Send a test event
		```json
		{
	  		"dividend": 10,
	  		"divisor": 5
		}
		```
	5. Set DLQ
		1. Configuration - Asynchronous invocation:
			1. Retry attempts: `0`
			2. Dead-letter queue service: `Amazon SQS`
			3. Queue: `kata-f-dlq`
4. Test 
	1. Create a test event
		1. Invocation type: `Asynchronous`
		2. Event name: `fail_event`
		3. Event JSON:
			```json
			{
	  			"dividend": 10,
	  			"divisor": 0
			}
			```
	2. Send `fail_event`
	3. Poll the Queue

## Cleanup
1. Delete Function `kata-f-dlq`
2. Delete Role `kata-role-dlq`
3. Delete Queue: `kata-q-dlq`
4. Delete Log Group: `/aws/lambda/kata-f-dlq`

## History
- 2025-10-23 success
